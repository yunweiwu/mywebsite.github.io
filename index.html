<!DOCTYPE html>
<html>
<head>
	<title>留言板</title>
</head>
<body>
	<h1>留言板</h1>
	<form id="loginForm" method="post" action="message.php">
		<label for="password">密码:</label>
		<input type="password" id="password" name="password">
		<input type="submit" value="登录">
	</form>

	<?php
	if ($_SERVER["REQUEST_METHOD"] == "POST" && $_POST["password"] == "123456") {
		echo "<h2>留言</h2>";
		echo "<form id='messageForm' method='post' action='message.php'>";
		echo "<textarea rows='4' cols='50' name='message' required></textarea>";
		echo "<br>";
		echo "<input type='submit' value='提交'>";
		echo "</form>";
	}

	if ($_SERVER["REQUEST_METHOD"] == "POST" && $_POST["password"] != "123456") {
		echo "<h3>密码错误，请重新登录</h3>";
	}

	if ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST["message"])) {
		$messageFile = fopen("messages.txt", "a");
		fwrite($messageFile, $_POST["message"] . "\n");
		fclose($messageFile);
	}

	if (file_exists("messages.txt")) {
		$messageFile = fopen("messages.txt", "r");
		while (!feof($messageFile)) {
			$message = fgets($messageFile);
			if (!empty($message)) {
				echo "<p>$message</p>";
			}
		}
		fclose($messageFile);
	}
	?>

</body>
</html>
